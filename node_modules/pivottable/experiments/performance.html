<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>2D Grid</title>
    <style>
        HTML, BODY{ overflow : hidden; }
    
        #grid, #scroll {
            font-family : Arial;
            border : 1px solid #ccc;
            overflow : hidden;
            position : absolute;
            left : 30px;
            top : 30px;
            right : 30px;
            bottom : 30px;
        }
        
        #grid div{
            white-space : nowrap;
            font-size : 0;
        }
        
        #grid div span{
            width : 80px;
            height : 15px;
            border : 1px solid #ccc;
            border-width : 0 1px 1px 0;
            display : inline-block;
            font-size : 12px;
            padding : 5px;
            overflow : hidden;
            /*box-shadow : 6px 5px 22px rgba(0,0,0,0.05) inset;*/
        }
    </style>
</head>
<body>
    <div id="grid">
        
    </div>
    <script>
        var grid   = document.getElementById("grid");
        var dataset = [];
        
        var x, y;
        function setup(width, height, cellWidth, cellHeight){
            x = Math.ceil(width / cellWidth);
            y = Math.ceil(height / cellHeight) * 30;
            
            for (var i = 0; i < y; i++) {
                dataset[i] = [];
                for (var j = 0; j < x; j++) {
                    dataset[i][j] = "mandsjalkjqpiueqiyeh".substr(Math.random()*20);
                }
            }
        }
        
        // function fill1(){
        //     var columns, rows = grid.childNodes;
        //     for (var i = 0; i < y; i++) {
        //         columns = rows[i].childNodes;
        //         for (var j = 0; j < x; j++) {
        //             columns[j].innerHTML = dataset[i][j];
        //         }
        //     }
        // }
        
        var lastStart;
        function fill2(start){
            if (lastStart == start)
                return;
            
            if (lastStart !== undefined) {
                var diff = start - lastStart;
                if (diff < 0) {
                    if (diff > -30) {
                        for (var row, i = -1; i > diff - 1; i--) {
                            row = grid.lastChild; 
                            grid.insertBefore(row, grid.firstChild);
                            var html = ""
                            for (var j = 0; j < x; j++) {
                                html += "<span>" + dataset[lastStart + i][j] + "</span>"
                            }
                            row.innerHTML = html;
                        }
                        
                        lastStart = start;
                        return;
                    }
                }
                else if (diff < 30) {
                    for (var row, i = 0; i < diff; i++) {
                        row = grid.firstChild;
                        grid.appendChild(row);
                        var html = ""
                        for (var j = 0; j < x; j++) {
                            html += "<span>" + dataset[start + x - diff + i][j] + "</span>"
                        }
                        row.innerHTML = html;
                    }
                
                    lastStart = start;
                    return;
                }
            }
            
            var html = "";
            for (var i = 0; i < y; i++) {
                html += "<div>";
                for (var r, j = 0; j < x; j++) {
                    r = dataset[i + start] || dataset[i];
                    html += "<span>" + r[j] + "</span>"
                }
                html += "</div>"
            }
            
            lastStart = start;
            
            grid.innerHTML = html;
        }
        
        var dt = new Date();
        setup(1600, 1200, 90, 25);
        console.log("Setup in " + (new Date() - dt) + "ms");
        
        // var dt = new Date();
        // fill1();
        // console.log("Filled(1) in " + (new Date() - dt) + "ms");
        
        y = y / 30;
        
        var dt = new Date();
        fill2();
        console.log("Filled(2) in " + (new Date() - dt) + "ms");
        
        var redraw;
        setInterval(function(){
            if (redraw) redraw();
            redraw = null;
        }, 20);
        
        function draw(func){
            if (redraw !== null) {
                func();
                redraw = 0;
            }
            else
                redraw = func;
        }
        
        var i = 0;
        grid.addEventListener("mousewheel", function(e){
            // buffer(fill2, 10);
            i = Math.min(Math.max(Math.round(i -= (e.wheelDeltaY / 6)), 0), 1600 * 30);
            
            draw(function(){
                fill2(Math.floor(i / 25));
                var remainder = i - (Math.floor(i / 25) * 25);
                grid.scrollTop = remainder;
            });
            
            e.preventDefault();
        });
        
    </script>
</body>
</html>